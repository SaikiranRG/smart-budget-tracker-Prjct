<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Transactions - Smart Budget Tracker</title>
  <style>
    body { font-family: Arial; margin: 30px; }
    nav { margin-bottom: 20px; }
    button { margin-right: 10px; padding: 8px 15px; }
    form { background: #f1f1f1; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
    th { background-color: #eee; }
  </style>
</head>
<body>

  <nav>
    <button onclick="window.location.href='dashboard.html'">Summary</button>
    <button onclick="window.location.href='transactions.html'">Transactions</button>
    <button onclick="logout()">Logout</button>
  </nav>

  <h2>Add New Transaction</h2>
  <form id="transactionForm">
    <label>Type:</label>
    <select id="type" required>
      <option value="income">Income</option>
      <option value="expense">Expense</option>
    </select><br><br>

    <label>Category:</label>
    <input type="text" id="category" placeholder="e.g. Groceries" required><br><br>

    <label>Amount:</label>
    <input type="number" id="amount" step="0.01" placeholder="e.g. 100.50" required><br><br>

    <label>Date:</label>
    <input type="date" id="date" required><br><br>

    <label>Description:</label>
    <input type="text" id="description" placeholder="Short note (optional)"><br><br>

    <button type="submit">Save Transaction</button>
  </form>

  <h3>Transaction History</h3>
  <table id="transactionsTable">
    <thead>
      <tr>
        <th>Type</th>
        <th>Category</th>
        <th>Amount</th>
        <th>Date</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const API_BASE = 'http://localhost:4000/api';
    const token = localStorage.getItem('token');
    if (!token) window.location.href = 'index.html';

    const transactionForm = document.getElementById('transactionForm');
    const transactionsTable = document.querySelector('#transactionsTable tbody');

    // Add new transaction
    transactionForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const type = document.getElementById('type').value;
      const category = document.getElementById('category').value;
      const amount = document.getElementById('amount').value;
      const date = document.getElementById('date').value;
      const description = document.getElementById('description').value;

      const res = await fetch(`${API_BASE}/transactions`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ type, category, amount, date, description })
      });

      const data = await res.json();
      alert(data.message);
      loadTransactions();
    });

    async function loadTransactions() {
      const res = await fetch(`${API_BASE}/transactions`, {
        headers: { 'Authorization': `Bearer ${token}` }
      });
      const data = await res.json();
      transactionsTable.innerHTML = '';

      if (data.transactions && data.transactions.length > 0) {
        data.transactions.forEach(t => {
          const row = `
            <tr>
              <td>${t.type}</td>
              <td>${t.category}</td>
              <td>${t.amount}</td>
              <td>${t.date}</td>
              <td>${t.description || ''}</td>
            </tr>
          `;
          transactionsTable.innerHTML += row;
        });
      } else {
        transactionsTable.innerHTML = '<tr><td colspan="5">No transactions found.</td></tr>';
      }
    }

    function logout() {
      localStorage.removeItem('token');
      window.location.href = 'index.html';
    }

    loadTransactions();
  </script>
</body>
</html>
